---
title: 从输入url到显示页面的步骤(详细)
date: 2017-04-13 21:39:14
tags: [HTML]
---
这个问题在前端面试中会经常被问到。作为一个前端工程师，明白网页从输入URL到显示页面到底发生了什么，这是一件很有必要的事情.
**从表面上分为以下几个过程**
1. 输入URL->DNS解析
2. 与服务器建立TCP连接
3. 发送HTTP请求
4. 服务器发送回应报文
5. 浏览器解析HTML文档并渲染页面
<!--more-->
## DNS解析
当输入url时，比如www.google.com，经过DNS解析为一个IP地址，这个IP地址就是服务器的地址。
### 域的划分
根域->顶级域->二级域名->三级域名......
举个例子
.com是根域名，baidu.com是顶级域名，www.baidu.com是二级域名.
### 域名服务器
能提供域名解析的服务器,上面的记录类型可以是A记录,NS记录,MX记录,CNAME
接下来一一解释这几个记录的意思：
* A记录：记录一个IP地址和一个主机名字(或者域名)，表示记录了主机为a的IP。
* NS记录：NS即Name Server，用来指定该域名由哪个DNS服务器进行解析
* CNAME记录：别名记录.这种记录允许将多个名字映射到同一台计算机上
### 解析过程
当我要通过浏览器访问一个网址的时候，根据电脑网络设置里的DNS，向这个域名解析服务器发送请求，然后本地DNS域名解析服务器会检查自己的缓存是否拥有这个地址，有的话直接返回所对应的IP地址.如果缓存中没有的话，就会从配置文件中读取根域名服务器的地址，然后依次从根域名服务器到顶级域名服务器到本地域名服务器，这样得到了要访问的主机的IP地址。其实就是一个递归查询的过程
## TCP连接
通过三次握手建立TCP连接.过程是：
1.客户机向服务器发送连接请求: SYN=1,seq=client_isn
2.服务器收到请求，回应: ack = client_isn+1,SYN=1,seq=server_isn
3.客户机收到回应之后发送回应:ack = server_isn+1,SYN=0,seq=client_isn+1
## 发送HTTP请求
建立TCP连接之后，发送HTTP请求，HTTP报文包裹在TCP报文中.服务器收到此报文然后提取处HTTP报文，然后处理HTTP请求，并发送回应报文。
**HTTPS**：https 中的s指的是SSL。SSL在HTTP和TCP之间，在HTTP报文进入TCP报文之前先对HTTP报文进行加密.加密过程在上一篇文章中已经提及过了，这里不再赘述。
#### HTTP请求由三部分组成：请求行，请求报头和请求正文.
* 请求行: Method Request-URL HTTP-Version CRLF
* 请求报头: Accept,Accept-Charset,Accept-Encoding,Accept-Language,Content-Type,Cookie,User-Agent
* 请求正文:当使用POST时，发送的数据储存在请求正文中，数据格式一般为json，此时需要设置Content-Type:application/json
#### HTTP响应报文由三部分组成: 状态码，响应报头，响应报文
状态码：
* 1xx: 100  101服务器遵从用户的请求转换到另外一种协议
* 2xx: 200  OK  
* 3xx: 301  Moved Permanently 永久性转移 302 临时转移 304 Not Modified
* 4xx: 401 Unauthorized 未授权 403 Forbidden  404 Not Found 
* 5xx: 500 服务器出现错误，不能完成客户请求  505 服务器不支持请求中的HTTP版本

## 浏览器解析并渲染页面
首先我们要明白，浏览器是边解析边进行页面渲染的.浏览器对HTML文件进行解析，构建DOM树。
如果遇到link标签且引用了外部CSS，则发出CSS文件的请求，服务器返回这个CSS文件，浏览器继续解析body部分的代码，遇到img标签引用了图片，向服务器发送请求，浏览器不会等到图片下载完，而是继续渲染后面的代码。
服务器返回图片文件，由于图片占用了一定的面积，影响了段落的排布，此时浏览器需要重新渲染这部分代码
当浏览器发现script标签时候，会立即执行这部分代码。
构造出DOM树和计算出样式数据之后，构造渲染树。渲染树和DOM有些相似，但是渲染树会忽略掉不需要渲染的元素，比如display:none的元素，渲染树创建好之后，浏览器就可以直接把页面绘制到屏幕上。
**重绘(repaints)**
部分节点需要更新，但是没有改变他的形状，比如改变了背景颜色，这样就会发生重绘
**重排(reflows)**
渲染树的一部分必须要更新，且节点的尺寸发生了变化，这样就会触发重排
**什么情况下触发重绘或重排**
增加或删除DOM节点
设置display:none(重排并重绘) visibility:hidden(重排)

